{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title|default:"Perfil" }} - Mi Blog{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-4 text-center mb-4 mb-md-0">
            <img src="{{ profile.get_avatar_url }}" alt="Avatar de {{ profile_user.username }}" class="img-fluid rounded-circle mb-3 shadow-sm" style="width: 150px; height: 150px; object-fit: cover; border: 3px solid #dee2e6;">
            <h3>{{ profile.full_name }}</h3>
            <p class="text-muted">@{{ profile_user.username }}</p>
            {% if profile_user == request.user %}
                <a href="{% url 'accounts:profile_update' %}" class="btn btn-primary btn-sm mb-2 d-block">Editar Perfil</a>
                <a href="{% url 'accounts:password_change' %}" class="btn btn-secondary btn-sm mb-2 d-block">Cambiar Contraseña</a>
            {% endif %}
        </div>
        <div class="col-md-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h4 class="mb-0">Información del Perfil</h4>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4 col-md-3">Nombre de Usuario:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile_user.username }}</dd>

                        <dt class="col-sm-4 col-md-3">Email:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile_user.email }}</dd>

                        {% if profile_user.first_name %}
                        <dt class="col-sm-4 col-md-3">Nombre:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile_user.first_name }}</dd>
                        {% endif %}

                        {% if profile_user.last_name %}
                        <dt class="col-sm-4 col-md-3">Apellido:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile_user.last_name }}</dd>
                        {% endif %}
                        
                        {% if profile.bio %}
                        <dt class="col-sm-4 col-md-3">Biografía:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile.bio|linebreaksbr }}</dd>
                        {% endif %}

                        {% if profile.website_url %}
                        <dt class="col-sm-4 col-md-3">Sitio Web:</dt>
                        <dd class="col-sm-8 col-md-9"><a href="{{ profile.website_url }}" target="_blank" rel="noopener noreferrer">{{ profile.website_url }}</a></dd>
                        {% endif %}

                        {% if profile.birth_date %}
                        <dt class="col-sm-4 col-md-3">Fecha de Nacimiento:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile.birth_date|date:"d F, Y" }}</dd>
                        {% endif %}

                        {% if profile.location %}
                        <dt class="col-sm-4 col-md-3">Ubicación:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile.location }}</dd>
                        {% endif %}

                        <dt class="col-sm-4 col-md-3">Miembro desde:</dt>
                        <dd class="col-sm-8 col-md-9">{{ profile_user.date_joined|date:"d F, Y" }}</dd>
                    </dl>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h4 class="mb-0">
                        {% if profile_user == request.user %}
                            Mis Posts
                        {% else %}
                            Posts de {{ profile_user.username }}
                        {% endif %}
                    </h4>
                </div>
                <div class="card-body">
                    {% if user_posts %}
                        <ul class="list-group list-group-flush">
                        {% for post in user_posts %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <a href="{{ post.get_absolute_url }}" class="fw-bold text-decoration-none">{{ post.title }}</a>
                                    <small class="d-block text-muted">
                                        {{ post.published_date|date:"d M, Y" }}
                                        {% if profile_user == request.user %}
                                            <span class="badge {% if post.status == 'published' and post.is_published %}bg-success{% elif post.status == 'published' and not post.is_published %}bg-info text-dark{% else %}bg-warning text-dark{% endif %} ms-2">
                                                {% if post.status == 'published' and post.is_published %}
                                                    Publicado
                                                {% elif post.status == 'published' and not post.is_published %}
                                                    Programado
                                                {% else %}
                                                    {{ post.get_status_display }}
                                                {% endif %}
                                            </span>
                                        {% endif %}
                                    </small>
                                </div>
                                <div>
                                    <a href="{{ post.get_absolute_url }}" class="btn btn-sm btn-outline-primary me-1" title="Ver Post"><i class="fas fa-eye"></i></a>
                                    {% if post.author == request.user or request.user.is_staff %}
                                    <a href="{% url 'blog:post_update' post.slug %}" class="btn btn-sm btn-outline-secondary" title="Editar Post"><i class="fas fa-edit"></i></a>
                                    {% endif %}
                                </div>
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-muted">
                            {% if profile_user == request.user %}
                                Aún no has creado ningún post. <a href="{% url 'blog:post_create' %}">¡Crea el primero!</a>
                            {% else %}
                                {{ profile_user.username }} aún no ha publicado ningún post.
                            {% endif %}
                        </p>
                    {% endif %}
                </div>
            </div>
            </div>
    </div>
</div>
{% endblock %}
